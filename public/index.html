<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="javascripts/datamaps.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<link rel="stylesheet" href="stylesheets/style.css">
<link rel="stylesheet" href="stylesheets/bootstrap.min.css">
<div class="container">
        <div id="tweet">
        <p id="tweet-text"></p>
    </div>
</div>
<div id="container">
</div>
<script>

    //Creates map

    var map = new Datamap({
        element: document.getElementById('container'),
        scope: 'usa',
        geographyConfig: {
            highlightOnHover: false,
            popupOnHover: false,
            borderWidth: 0.4,
            borderColor: '#565656',
        },

        fills: {
            	defaultFill: '#151515'
            }
    });

    var json_data = d3.json("/tweets", function(error, json) {
                if (error) return console.warn(error);
                json_data = json
     });

function mapPoints(){
    d3.json("/tweets", function(error, json) {
        if (error) return console.warn(error);
                data = json


                map.svg.selectAll("circle")
                .data(data)
                .enter()
                .append("circle")
                .attr("r",10)
                .attr("fill", "steelblue")
                .on("mouseover",function(d){
                    d3.select(this).attr("r", 5);
                    $('#tweet-text').text(d.content);
                })
                .on("mouseout", function(d){
                    d3.select(this).attr("r", 1);
                    $('#tweet-text').text("");
                })
                .transition()
                .duration(700)
                .attr("r",1)
                .attr("fill", "steelblue")
                .attr("cx", function(d) {
                    return map.projection([d.latitude, d.longitude])[0];
                })
                .attr("cy", function(d) {
                    return map.projection([d.latitude, d.longitude])[1];
                })
    });

};


$(function() {

    setInterval(mapPoints, 2000);
});

</script>